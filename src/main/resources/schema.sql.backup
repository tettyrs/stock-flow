-- Stock Service Database Schema
-- This file is for reference only.
-- Spring Boot will auto-create tables based on JPA entities when spring.jpa.hibernate.ddl-auto=update
-- Tables will be created on first run if they don't exist

-- Table: item
-- Stores product/item information with real-time stock count
CREATE TABLE IF NOT EXISTS `item` (
    `id` BIGINT NOT NULL AUTO_INCREMENT,
    `name` VARCHAR(255) NOT NULL,
    `price` DOUBLE NOT NULL,
    `stock` INT NOT NULL DEFAULT 0 COMMENT 'Real-time stock count',
    PRIMARY KEY (`id`),
    INDEX `idx_item_name` (`name`),
    INDEX `idx_item_stock` (`stock`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='Product/Item master data';

-- Table: inventory
-- Stores inventory transactions (Top-Up and Withdrawal)
CREATE TABLE IF NOT EXISTS `inventory` (
    `id` BIGINT NOT NULL AUTO_INCREMENT,
    `item_id` BIGINT NOT NULL,
    `qty` INT NOT NULL COMMENT 'Quantity for transaction',
    `type` VARCHAR(10) NOT NULL COMMENT 'Transaction type: T=Top-Up, W=Withdrawal',
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    INDEX `idx_inventory_item_id` (`item_id`),
    INDEX `idx_inventory_type` (`type`),
    INDEX `idx_inventory_created_at` (`created_at`),
    CONSTRAINT `fk_inventory_item` FOREIGN KEY (`item_id`) REFERENCES `item` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='Inventory transaction history';

-- Table: orders
-- Stores customer orders
CREATE TABLE IF NOT EXISTS `orders` (
    `id` BIGINT NOT NULL AUTO_INCREMENT,
    `order_no` VARCHAR(255) NOT NULL UNIQUE COMMENT 'Unique order number',
    `item_id` BIGINT NOT NULL,
    `qty` INT NOT NULL COMMENT 'Order quantity',
    `price` DOUBLE NOT NULL COMMENT 'Item price at time of order',
    `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`),
    INDEX `idx_order_no` (`order_no`),
    INDEX `idx_order_item_id` (`item_id`),
    INDEX `idx_order_created_at` (`created_at`),
    CONSTRAINT `fk_order_item` FOREIGN KEY (`item_id`) REFERENCES `item` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='Customer orders';

-- Sample Data (based on uploaded image)
INSERT INTO `item` (`id`, `name`, `price`, `stock`) VALUES
(1, 'Pen', 5, 0),
(2, 'Book', 10, 0),
(3, 'Bag', 30, 0),
(4, 'Pencil', 3, 0),
(5, 'Shoe', 45, 0),
(6, 'Box', 5, 0),
(7, 'Cap', 25, 0)
ON DUPLICATE KEY UPDATE `name` = VALUES(`name`), `price` = VALUES(`price`);

-- Sample Inventory Transactions (Top-Up)
INSERT INTO `inventory` (`id`, `item_id`, `qty`, `type`) VALUES
(1, 1, 5, 'T'),
(2, 2, 10, 'T'),
(3, 3, 30, 'T'),
(4, 4, 3, 'T'),
(5, 5, 45, 'T'),
(6, 6, 5, 'T'),
(7, 7, 25, 'T'),
(8, 4, 7, 'T'),
(9, 5, 10, 'W')
ON DUPLICATE KEY UPDATE `qty` = VALUES(`qty`), `type` = VALUES(`type`);

-- Sample Orders
INSERT INTO `orders` (`order_no`, `item_id`, `qty`, `price`) VALUES
('O1', 1, 2, 5),
('O2', 2, 3, 10),
('O3', 5, 4, 45),
('O4', 4, 1, 2),
('O5', 5, 2, 45),
('O6', 6, 3, 5),
('O7', 1, 5, 5),
('O8', 2, 4, 10),
('O9', 3, 2, 30),
('O10', 4, 3, 3)
ON DUPLICATE KEY UPDATE `item_id` = VALUES(`item_id`), `qty` = VALUES(`qty`), `price` = VALUES(`price`);
